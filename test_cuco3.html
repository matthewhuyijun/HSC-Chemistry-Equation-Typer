<!DOCTYPE html>
<html>
<head>
    <title>Test CuCO3 Conversion</title>
</head>
<body>
    <h1>Testing CuCO3 Conversion</h1>
    
    <h2>Test Cases:</h2>
    <ul>
        <li><strong>CuCO3</strong> (copper carbonate) - CO3 is attached to Cu</li>
        <li><strong>Cu CO3</strong> (with space) - CO3 is separate</li>
        <li><strong>(CO3)</strong> (in parentheses) - CO3 is isolated</li>
        <li><strong>CO3</strong> (alone) - CO3 is isolated</li>
    </ul>
    
    <script>
        function convertPolyatomicIons(text) {
            let val = text;
            
            const polyatomicIons = {
                'CO3': 'CO_{3}',
                'NH4': 'NH_{4}'
            };
            
            for (let [ion, formatted] of Object.entries(polyatomicIons)) {
                if (val.includes(formatted)) {
                    continue;
                }
                
                const escapedIon = ion.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                
                // Current regex: requires word boundaries
                const currentRegex = new RegExp(`(?<![A-Za-z_{])${escapedIon}(?![A-Za-z_{])`, 'g');
                
                console.log(`Testing "${text}" with ion "${ion}"`);
                console.log(`  Current regex matches:`, currentRegex.test(text));
            }
            
            return val;
        }
        
        // Test cases
        const tests = ['CuCO3', 'Cu CO3', '(CO3)', 'CO3', 'NH4Cl'];
        tests.forEach(test => {
            console.log('\n=== Testing:', test, '===');
            convertPolyatomicIons(test);
        });
    </script>
</body>
</html>
